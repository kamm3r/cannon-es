---
import type { MarkdownHeading } from 'astro';
import type { CollectionEntry } from 'astro:content';
import HeadCommon from '../components/HeadCommon.astro';
import HeadSEO from '../components/HeadSEO.astro';
import Header from '../components/navigation/Header.astro';
import PageContent from '../components/PageContent/PageContent.astro';
import LeftSidebar from '../components/navigation/LeftSidebar.astro';
import Footer from '../components/Footer/Footer.astro';
import { GITHUB_EDIT_URL, SITE } from '../consts';
import RightSidebar from '../components/navigation/RightSidebar.astro';

type Props = CollectionEntry<'docs'>['data'] & {
  headings: MarkdownHeading[];
};

const { headings, ...data } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const currentPage = Astro.url.pathname;
const currentFile = `src/content/docs${currentPage.replace(/\/$/, '')}.md`;
---

<html class="initial">
  <head>
    <HeadCommon />
    <HeadSEO {...data} canonicalUrl={canonicalURL} />
    <title>
      {`${data.title} ðŸš€ ${SITE.title}`}
    </title>
  </head>

  <body
    class="bg-gray-50 text-[#0c0e11] dark:bg-[#0c0e11] dark:text-gray-50 flex min-h-screen flex-col items-center px-4 transition-colors duration-300"
  >
    <Header isNotFound={false} currentPage={currentPage} />
    <main
      class="grid w-full max-w-screen-2xl flex-1 grid-cols-1 gap-4 md:grid-cols-[250px_auto] lg:grid-cols-[250px_auto_250px]"
    >
      <aside
        id="grid-left"
        class="sticky top-20 col-span-1 hidden h-auto max-h-[calc(100vh-80px)] w-full flex-col justify-start overflow-hidden pt-4 transition-colors duration-300 hover:overflow-y-scroll md:top-24 md:flex md:max-h-[calc(100vh-96px)] md:pt-0"
        title="Site Navigation"
      >
        <LeftSidebar currentPage={currentPage} />
      </aside>
      <div
        id="grid-main"
        class="col-span-1 flex min-h-full w-full flex-col items-center justify-center pt-5"
      >
        <PageContent title={data.title}>
          <slot />
        </PageContent>
      </div>
      <aside
        id="grid-right"
        class="sticky top-20 col-span-1 hidden h-auto max-h-[calc(100vh-80px)] w-full flex-col justify-start overflow-hidden pt-4 transition-colors duration-300 md:top-24 md:flex md:max-h-[calc(100vh-96px)] md:pt-0"
        title="Table of Contents"
      >
        <RightSidebar
          headings={headings}
          githubEditUrl={GITHUB_EDIT_URL}
          title={data.title}
        />
      </aside>
    </main>
    <Footer path={currentFile} />
  </body>
</html>
